import os
from pathlib import Path
from cads.utils.dcm_nifti_conversion import dicom_to_nifti

def get_full_paths(root_dir, id_list):
    id_list = ['CT_'+i for i in id_list]
    root_path = Path(root_dir)
    full_paths = []
    
    for path in root_path.rglob("*"):
        if path.is_dir() and path.name in id_list:
            full_paths.append(str(path))
            
    return full_paths

# from idc_index import IDCClient 
# test_series = \
# ['1.2.840.113654.2.55.195946682403058845904768502826466194287', \
#  '1.2.840.113654.2.55.221581533879834196356530174246594024639', \
#  '1.2.840.113654.2.55.71263399928421039572326605504649736531', \
#  '1.2.840.113654.2.55.79318439085250760439172236218713769408', \
#  '1.2.840.113654.2.55.191661316001774647835097522264785668378', \
#  '1.2.840.113654.2.55.304075689731327662774315497031574106725', \
#  '1.2.840.113654.2.55.283399418711252976131557177419186072875', \
#  '1.2.840.113654.2.55.21461438679308812574178613217680405233', \
#  '1.2.840.113654.2.55.97114726565566537928831413367474015470', \
#  '1.2.840.113654.2.55.122344168497038128022524906545138736420', \
#  '1.2.840.113654.2.55.229650531101716203536241646069123704792', \
#  '1.2.840.113654.2.55.257926562693607663865369179341285235858', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.135383252566920035150987356231', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.315696884435641630605419115484', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.230644512623268816899910856967', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.330739122093904668699523188451', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.690272753571338193252806012518', \
#  '1.3.6.1.4.1.14519.5.2.1.7009.9004.310718458447911706151879406927']

# c= IDCClient()

# c.download_from_selection(downloadDir="/mnt/hdda/murong/IDC",seriesInstanceUID=test_series)


test_series = [
    '1.2.840.113654.2.55.195946682403058845904768502826466194287',
    '1.2.840.113654.2.55.221581533879834196356530174246594024639',
    '1.2.840.113654.2.55.71263399928421039572326605504649736531',
    '1.2.840.113654.2.55.79318439085250760439172236218713769408',
    '1.2.840.113654.2.55.191661316001774647835097522264785668378',
    '1.2.840.113654.2.55.304075689731327662774315497031574106725',
    '1.2.840.113654.2.55.283399418711252976131557177419186072875',
    '1.2.840.113654.2.55.21461438679308812574178613217680405233',
    '1.2.840.113654.2.55.97114726565566537928831413367474015470',
    '1.2.840.113654.2.55.122344168497038128022524906545138736420',
    '1.2.840.113654.2.55.229650531101716203536241646069123704792',
    '1.2.840.113654.2.55.257926562693607663865369179341285235858',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.135383252566920035150987356231',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.315696884435641630605419115484',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.230644512623268816899910856967',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.330739122093904668699523188451',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.690272753571338193252806012518',
    '1.3.6.1.4.1.14519.5.2.1.7009.9004.310718458447911706151879406927'
]

root_dir = '/mnt/hdda/murong/IDC/nlst'
save2nifti_folder = '/mnt/hdda/murong/IDC/nlst_nifti'
dcm_all = get_full_paths(root_dir, test_series)
dcm_all.sort()

for dcm in dcm_all:
    img_id = dcm.split('/')[-1]
    _ = dicom_to_nifti(dcm, savenifti=True, output_file=os.path.join(save2nifti_folder, img_id+'.nii.gz'))
